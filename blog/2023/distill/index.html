<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Inference of human population history from a single genome | Artem Lomakin</title> <meta name="author" content="Artem Lomakin"> <meta name="description" content="My attempt to replicate Pairwise Sequentially Markovian Coalescent (PSMC) model - one of the classical population genetic algorithm - in Python and to trace the evolutionary history of humanity."> <meta name="keywords" content="academic-website, computational-biology, spatial-genomics, cancer-genomic"> <meta property="og:site_name" content="Artem Lomakin"> <meta property="og:type" content="article"> <meta property="og:title" content="Artem Lomakin | Inference of human population history from a single genome"> <meta property="og:url" content="https://tulerpetontidae.github.io/blog/2023/distill/"> <meta property="og:description" content="My attempt to replicate Pairwise Sequentially Markovian Coalescent (PSMC) model - one of the classical population genetic algorithm - in Python and to trace the evolutionary history of humanity."> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Inference of human population history from a single genome"> <meta name="twitter:description" content="My attempt to replicate Pairwise Sequentially Markovian Coalescent (PSMC) model - one of the classical population genetic algorithm - in Python and to trace the evolutionary history of humanity."> <meta name="twitter:site" content="@LomakinAI"> <meta name="twitter:creator" content="@LomakinAI"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%AC&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tulerpetontidae.github.io/blog/2023/distill/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Inference of human population history from a single genome",
      "description": "My attempt to replicate Pairwise Sequentially Markovian Coalescent (PSMC) model - one of the classical population genetic algorithm - in Python and to trace the evolutionary history of humanity.",
      "published": "November 25, 2023",
      "authors": [
        {
          "author": "Artem Lomakin",
          "authorURL": "tulerpetontidae.github.io",
          "affiliations": [
            {
              "name": "EMBL-EBI, UK",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Artem </span>Lomakin</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Inference of human population history from a single genome</h1> <p>My attempt to replicate Pairwise Sequentially Markovian Coalescent (PSMC) model - one of the classical population genetic algorithm - in Python and to trace the evolutionary history of humanity.</p> </d-title><d-byline></d-byline><d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#introduction">Introduction</a></div> <div><a href="#basics-of-coalescence-theory">Basics of coalescence theory</a></div> <div><a href="#psmc-model">PSMC model</a></div> <div><a href="#python-implementation">Python implementation</a></div> <div><a href="#simulated-data-study">Simulated data study</a></div> <div><a href="#real-human-genomes-and-our-unique-history">Real human genomes and our unique history</a></div> <div><a href="#afterword">Afterword</a></div> </nav> </d-contents> <h2 id="introduction">Introduction</h2> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-03.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-03.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-03.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-03.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>The wonders of population genetics allow us to reveal the echoes of the tumultuous times our ancestors survived, forever imprinted in our genome. In this thread, I’ll share my experience replicating one of my all-time favourite paper “Inference of human population history from individual whole-genome sequences”<d-cite key="Li2011-nn"></d-cite> by <a href="https://en.wikipedia.org/wiki/Heng_Li" rel="external nofollow noopener" target="_blank">Heng Li</a> and <a href="https://en.wikipedia.org/wiki/Richard_M._Durbin" rel="external nofollow noopener" target="_blank">Richard M. Durbin</a>. The paper introduces the method to infer population size history from a single genome. Meaning, you give it a genomic sequence and it outputs all changes in ancestral effective population size on a time scale from ~10,000 to ~10,000,000 years ago. How?</p> <hr> <h2 id="basics-of-coalescence-theory">Basics of coalescence theory</h2> <p>Let’s start with the basics. Humans inherit two sets of chromosomes, one from each parent, each with their own distinct mutations. By knowing the mutation rate, we can estimate when the most recent common ancestor (MRCA), who possessed the original version of the DNA, lived.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-08.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-08.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-08.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-08.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>In the absence of recombination, we can estimate one MRCA per chromosome, as each generation discards one parental chromosome. Recombination allows for the exchange of genetic information between chromosome sets, retaining fragments of parental variation for future generations.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-01.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-01.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-01.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-01.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>This implies that our chromosomes are a mosaic of thousands of fragments, each originating from thousands of ancestors spread across millions of years! A single chromosome holds a rich tapestry of our ancestral history.</p> <p>The distribution of the MRCAs is important. According to coalescent theory, this distribution follows an exponent, assuming a constant effective population size (𝗡𝗲). 𝗡𝗲 is an abstract value influenced by factors such as number of individuals and population structure.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-02.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-02.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-02.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-02.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>A direct relationship exists between 𝗡𝗲 at a given time and the probability of coalescence events. Larger populations have lower probabilities; conversely, during a population bottleneck, the number of coalescence events (MRCAs) rises for the corresponding time period.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-04.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-04.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-04.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-04.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <hr> <h2 id="psmc-model">PSMC model</h2> <p>In practice, we don’t know where crossover breakpoints happened. The authors designed a sequential hidden Markov model (HMM) to directly link population size history and genome sequence heterozygosity.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-05.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-05.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-05.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-05.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>The paper’s achievement lies in deriving the math required to define this HMM, assuming a Markovian process. Though a strong assumption, as the saying goes, “All models are wrong, but some are useful.” This model has indeed proven to be both effective and useful.</p> <p>Given the length of the genome sequence, computing probabilities of latent variables is very costly. So training this beast is more manageable using the EM-algorithm. Instead of directly maximising the likelihood, EM employs a lower bound that is more cost-effective to maximise.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-09.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-09.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-09.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-09.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <hr> <h2 id="python-implementation">Python implementation</h2> <p>The paper’s achievement lies in deriving the math required to define this HMM, assuming a Markovian process. Though a strong assumption, as the saying goes, “All models are wrong, but some are useful.” This model has indeed proven to be both effective and useful.</p> <d-code block="" language="javascript"> var x = 25; function(x) { return x * x; } </d-code> <p><strong>Note:</strong> <code class="language-plaintext highlighter-rouge">&lt;d-code&gt;</code> blocks do not look good in the dark mode. You can always use the default code-highlight using the <code class="language-plaintext highlighter-rouge">highlight</code> liquid tag:</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <hr> <h2 id="simulated-data-study">Simulated data study</h2> <p>At first, I tested it on 300 Mb synthetic data, roughly the size of the 1st chromosome. Results look similar to the paper, with pitfalls such as low accuracy on time intervals before ~10K years and above ~2M years, and oversmoothing of rapid step-like population size changes.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-06.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-06.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-06.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-06.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <h2 id="real-human-genomes-and-our-unique-history">Real human genomes and our unique history</h2> <p>Now the fun part – what could real genomes tell? I run PSMC on the chromosomes 1-5 for six individuals: three of diverse African origins (San, Mbuti, and Maasai), a European (French), an East Asian (Japanese), and an Austronesian (Ami). Genome data is from <a href="https://internationalgenome.org" rel="external nofollow noopener" target="_blank">The International Genome Sample Resource</a>.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-07.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-07.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-07.svg-1400.webp"></source> <img src="/assets/img/psmc/psmc_1-07.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>It’s evident that all humans shared similar history until approximately 150K years ago, surviving a significant bottleneck around 1M years ago. This bottleneck appears to be embedded not only in our DNA but also in fossil records. Climate change may be a factor, among others.</p> <p>Approximately 150,000 years ago, the history of the selected individuals’ ancestors diverged. The noteworthy bottleneck experienced by all migrating populations (🟦) was surprisingly similar, despite the vast distances between their descendants.</p> <p>In contrast, the ancestors of African populations (🟥) had remarkably different histories, resulting in a decline in effective population size concurrent with their relatives’ migrations to Eurasia. The Toba volcanic eruption is among the hypotheses to explain this phenomenon.</p> <p>By correlating inferred population sizes with archaeological data, it’s tempting to speculate about causality. E.g., did the use of 🔥 or increasing 🧠 volume aided the recovery from the bottleneck 1M years ago? However, as with any model, 𝗡𝗲 is to be interpreted with care</p> <hr> <h2 id="afterword">Afterword</h2> <p>A little story at the end. Why did I spend time on this instead of working on my thesis?</p> <p>Well, partly because this method is just awesome. Partly because I really wanted to play with HMMs and EM. But also, because I made a promise to myself at the beginning of my PhD to try. During my PhD interview with @Nick_Goldman, I shared this as my favourite paper, acknowledging my limited understanding of how the method works. Nick then asked me how long it’d take to replicate if the math is provided, and I somewhat naively replied, “I guess three weeks?🤔”.</p> <p>It took me numerous evenings of dedicated effort to replicate the task at hand. As someone with limited computational experience four years ago, I cannot stress enough how much of an underestimation the “three weeks” suggestion was.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2018-12-22-distill.bib"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Artem Lomakin. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>