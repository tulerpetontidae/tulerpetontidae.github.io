<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://tulerpetontidae.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://tulerpetontidae.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2023-11-26T03:47:37+00:00</updated><id>https://tulerpetontidae.github.io/feed.xml</id><title type="html">blank</title><subtitle>Artem&apos;s personal academic website. </subtitle><entry><title type="html">Inference of human population history from a single genome</title><link href="https://tulerpetontidae.github.io/blog/2023/distill/" rel="alternate" type="text/html" title="Inference of human population history from a single genome"/><published>2023-11-25T00:00:00+00:00</published><updated>2023-11-25T00:00:00+00:00</updated><id>https://tulerpetontidae.github.io/blog/2023/distill</id><content type="html" xml:base="https://tulerpetontidae.github.io/blog/2023/distill/"><![CDATA[<h2 id="introduction">Introduction</h2> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-03.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-03.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-03.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-03.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>The wonders of population genetics allow us to reveal the echoes of the tumultuous times our ancestors survived, forever imprinted in our genome. In this thread, Iâ€™ll share my experience replicating one of my all-time favourite paper â€œInference of human population history from individual whole-genome sequencesâ€<d-cite key="Li2011-nn"></d-cite> by <a href="https://en.wikipedia.org/wiki/Heng_Li">Heng Li</a> and <a href="https://en.wikipedia.org/wiki/Richard_M._Durbin">Richard M. Durbin</a>. The paper introduces the method to infer population size history from a single genome. Meaning, you give it a genomic sequence and it outputs all changes in ancestral effective population size on a time scale from ~10,000 to ~10,000,000 years ago. How?</p> <hr/> <h2 id="basics-of-coalescence-theory">Basics of coalescence theory</h2> <p>Letâ€™s start with the basics. Humans inherit two sets of chromosomes, one from each parent, each with their own distinct mutations. By knowing the mutation rate, we can estimate when the most recent common ancestor (MRCA), who possessed the original version of the DNA, lived.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-08.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-08.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-08.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-08.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>In the absence of recombination, we can estimate one MRCA per chromosome, as each generation discards one parental chromosome. Recombination allows for the exchange of genetic information between chromosome sets, retaining fragments of parental variation for future generations.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-01.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-01.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-01.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-01.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>This implies that our chromosomes are a mosaic of thousands of fragments, each originating from thousands of ancestors spread across millions of years! A single chromosome holds a rich tapestry of our ancestral history.</p> <p>The distribution of the MRCAs is important. According to coalescent theory, this distribution follows an exponent, assuming a constant effective population size (ğ—¡ğ—²). ğ—¡ğ—² is an abstract value influenced by factors such as number of individuals and population structure.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-02.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-02.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-02.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-02.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>A direct relationship exists between ğ—¡ğ—² at a given time and the probability of coalescence events. Larger populations have lower probabilities; conversely, during a population bottleneck, the number of coalescence events (MRCAs) rises for the corresponding time period.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-04.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-04.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-04.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-04.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <hr/> <h2 id="psmc-model">PSMC model</h2> <p>In practice, we donâ€™t know where crossover breakpoints happened. The authors designed a sequential hidden Markov model (HMM) to directly link population size history and genome sequence heterozygosity.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-05.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-05.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-05.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-05.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>The paperâ€™s achievement lies in deriving the math required to define this HMM, assuming a Markovian process. Though a strong assumption, as the saying goes, â€œAll models are wrong, but some are useful.â€ This model has indeed proven to be both effective and useful.</p> <p>Given the length of the genome sequence, computing probabilities of latent variables is very costly. So training this beast is more manageable using the EM-algorithm. Instead of directly maximising the likelihood, EM employs a lower bound that is more cost-effective to maximise.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-09.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-09.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-09.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-09.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <hr/> <h2 id="python-implementation">Python implementation</h2> <p>The paperâ€™s achievement lies in deriving the math required to define this HMM, assuming a Markovian process. Though a strong assumption, as the saying goes, â€œAll models are wrong, but some are useful.â€ This model has indeed proven to be both effective and useful.</p> <d-code block="" language="javascript"> var x = 25; function(x) { return x * x; } </d-code> <p><strong>Note:</strong> <code class="language-plaintext highlighter-rouge">&lt;d-code&gt;</code> blocks do not look good in the dark mode. You can always use the default code-highlight using the <code class="language-plaintext highlighter-rouge">highlight</code> liquid tag:</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <hr/> <h2 id="simulated-data-study">Simulated data study</h2> <p>At first, I tested it on 300 Mb synthetic data, roughly the size of the 1st chromosome. Results look similar to the paper, with pitfalls such as low accuracy on time intervals before ~10K years and above ~2M years, and oversmoothing of rapid step-like population size changes.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-06.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-06.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-06.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-06.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <h2 id="real-human-genomes-and-our-unique-history">Real human genomes and our unique history</h2> <p>Now the fun part â€“ what could real genomes tell? I run PSMC on the chromosomes 1-5 for six individuals: three of diverse African origins (San, Mbuti, and Maasai), a European (French), an East Asian (Japanese), and an Austronesian (Ami). Genome data is from <a href="https://internationalgenome.org">The International Genome Sample Resource</a>.</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/psmc/psmc_1-07.svg-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/psmc/psmc_1-07.svg-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/psmc/psmc_1-07.svg-1400.webp"/> <img src="/assets/img/psmc/psmc_1-07.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Itâ€™s evident that all humans shared similar history until approximately 150K years ago, surviving a significant bottleneck around 1M years ago. This bottleneck appears to be embedded not only in our DNA but also in fossil records. Climate change may be a factor, among others.</p> <p>Approximately 150,000 years ago, the history of the selected individualsâ€™ ancestors diverged. The noteworthy bottleneck experienced by all migrating populations (ğŸŸ¦) was surprisingly similar, despite the vast distances between their descendants.</p> <p>In contrast, the ancestors of African populations (ğŸŸ¥) had remarkably different histories, resulting in a decline in effective population size concurrent with their relativesâ€™ migrations to Eurasia. The Toba volcanic eruption is among the hypotheses to explain this phenomenon.</p> <p>By correlating inferred population sizes with archaeological data, itâ€™s tempting to speculate about causality. E.g., did the use of ğŸ”¥ or increasing ğŸ§  volume aided the recovery from the bottleneck 1M years ago? However, as with any model, ğ—¡ğ—² is to be interpreted with care</p> <hr/> <h2 id="afterword">Afterword</h2> <p>A little story at the end. Why did I spend time on this instead of working on my thesis?</p> <p>Well, partly because this method is just awesome. Partly because I really wanted to play with HMMs and EM. But also, because I made a promise to myself at the beginning of my PhD to try. During my PhD interview with @Nick_Goldman, I shared this as my favourite paper, acknowledging my limited understanding of how the method works. Nick then asked me how long itâ€™d take to replicate if the math is provided, and I somewhat naively replied, â€œI guess three weeks?ğŸ¤”â€.</p> <p>It took me numerous evenings of dedicated effort to replicate the task at hand. As someone with limited computational experience four years ago, I cannot stress enough how much of an underestimation the â€œthree weeksâ€ suggestion was.</p>]]></content><author><name>Artem Lomakin</name></author><category term="coding,"/><category term="popgen,"/><category term="illustrations"/><summary type="html"><![CDATA[My attempt to replicate Pairwise Sequentially Markovian Coalescent (PSMC) model - one of the classical population genetic algorithm - in Python and to trace the evolutionary history of humanity.]]></summary></entry></feed>